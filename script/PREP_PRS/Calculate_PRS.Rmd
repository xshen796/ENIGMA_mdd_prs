---
title: "Calculate PRS"
author: X Shen  
date: "\n`r format(Sys.time(), '%d %B, %Y')`"
output: github_document
---

For more information about PRSice 2.0, see its [wiki page](http://prsice.info/)

------------------------------------------------------------------------

## Set up a local copy of the github repository

Clone files:

```{bash, eval=F}
git clone https://github.com/xshen796/ENIGMA_mdd_prs.git
cd ENIGMA_mdd_prs
```

Set permission to files:

```{bash, eval=F}
find . -executable -exec chmod +x {} \;
```

------------------------------------------------------------------------

## Environment preparation

R libraries required:

-   dplyr
-   optparse

Open R, test if these packages are installed.

```{r, eval = F}
library(dplyr)
library(optparse)
```

If R gives an error message, install the package(s) using:

```{r, eval = F}
install.packages('dplyr')
install.packages('optparse')
```

------------------------------------------------------------------------

## File preparation

#### Plink-format genetic data

At least three files should be included with suffixes: .bim, .bed, .fam.

#### Phenotype file

Create a dummy file with the .bim file. Use command given below.

```{bash, eval = F}
Rscript util/create_dummypheno.R <.bim file location>
```

Here is an example using plink data in the *data* folder:

```{bash, eval = F}
Rscript util/create_dummypheno.R data/TOY_TARGET_DATA.bim
```

A file will be created as *data/dummy_pheno.txt .*

------------------------------------------------------------------------

### Run PRSice

Run the job file to generate all PRS using the command below.

```{bash, eval=F}
bash job.PRS_prsice2.sh -d <base name for plink-format files>
```

Here is an example using plink data in the *data* folder:

```{bash, eval = F}
bash job.PRS_prsice2.sh -d data/TOY_TARGET_DATA
```

**!!** If you see an error about duplicated variants looking like:

> Error: A total of 7456 duplicated SNP ID detected out of 5958288 input SNPs! ...

Run the above command again. The script will pick up the valid SNP list when re-calculating PRS.

------------------------------------------------------------------------

### A checklist for output files

**Polygenic risk scores**

-   PRS/MDD_orig.all_scores

-   PRS/MDD_sbayesr.all_scores

-   PRS/BMI_orig.all_scores

-   PRS/BMI_sbayesr.all_scores

-   ...

**SNP lists used for calculating PRS**

-   PRS/MDD_orig.snps

-   PRS/MDD_sbayesr.snps

-   PRS/BMI_orig.snps

-   PRS/BMI_sbayesr.snps

-   ...

------------------------------------------------------------------------

### Upload PRS and supportive files

Upload the entire *PRS* folder to the medflix server. \<to be finished\>
